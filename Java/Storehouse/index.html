
<!DOCTYPE html>
<html class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="shortcut icon" href="../../assets/images/favicon.ico">
      
      <meta name="generator" content="mkdocs+mkdocs-material#1.0.3">
    
    
      
        <title>Склад (Android) - Документация Scorocode</title>
      
    
    
      <script src="../../assets/javascripts/modernizr-facb31f4a3.js"></script>
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application-f3ab63f78a.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-02ce7adcc2.palette.css">
      
      
    
    
  </head>
  
  
  
  
    <body data-md-color-primary="blue" data-md-color-accent="light-blue">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Документация Scorocode" class=" md-logo  md-header-nav__button">
          
            <img src="../../logo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
                <span class="md-header-nav__parent">
                  Примеры приложений
                </span>
              
            
            Склад (Android)
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <div class="md-search__overlay"></div>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false">
      <label class="md-icon md-search__icon" for="search"></label>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result"></div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            
          </div>
      </div>
    </div>
  </nav>
</header>
    
    <div class="md-container">
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <i class=" md-logo  md-nav__button">
      
        <img src="../../logo.png">
      
    </i>
    Документация Scorocode
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Scorocode
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-1">
        Scorocode
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../.." title="Общие сведения" class="md-nav__link">
        Общие сведения
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../main/main1/" title="Начало работы" class="md-nav__link">
        Начало работы
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../main/main2/" title="Личный кабинет" class="md-nav__link">
        Личный кабинет
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../app/app/" title="Работа с приложением" class="md-nav__link">
        Работа с приложением
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../app/app1/" title="Аналитика приложения" class="md-nav__link">
        Аналитика приложения
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../app/app2/" title="Данные приложения" class="md-nav__link">
        Данные приложения
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../app/app3/" title="Индексы" class="md-nav__link">
        Индексы
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../app/app4/" title="Триггеры" class="md-nav__link">
        Триггеры
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../app/app5/" title="Серверный код приложения" class="md-nav__link">
        Серверный код приложения
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../app/bots/" title="Боты Telegram" class="md-nav__link">
        Боты Telegram
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../app/app6/" title="Настройки приложения" class="md-nav__link">
        Настройки приложения
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      HTTP API
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-2">
        HTTP API
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../httpapi/appapi/" title="Работа с приложением" class="md-nav__link">
        Работа с приложением
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../httpapi/httpapi1/" title="Пользователи" class="md-nav__link">
        Пользователи
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../httpapi/httpapi2/" title="Данные" class="md-nav__link">
        Данные
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../httpapi/httpapi3/" title="Файлы" class="md-nav__link">
        Файлы
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../httpapi/httpapi4/" title="Сообщения" class="md-nav__link">
        Сообщения
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../httpapi/httpapi5/" title="Скрипты" class="md-nav__link">
        Скрипты
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../httpapi/httpapi6/" title="Статистика" class="md-nav__link">
        Статистика
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      JavaScript SDK
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-3">
        JavaScript SDK
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../JS/javascript/" title="JavaScript SDK" class="md-nav__link">
        JavaScript SDK
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../JS/Scorocode/" title="Scorocode" class="md-nav__link">
        Scorocode
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../JS/Scorocode.Object/" title="Scorocode.Object" class="md-nav__link">
        Scorocode.Object
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../JS/Scorocode.Query/" title="Scorocode.Query" class="md-nav__link">
        Scorocode.Query
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../JS/Scorocode.UpdateOps/" title="Scorocode.UpdateOps" class="md-nav__link">
        Scorocode.UpdateOps
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../JS/Scorocode.User/" title="Scorocode.User" class="md-nav__link">
        Scorocode.User
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../JS/Scorocode.Messenger/" title="Scorocode.Messenger" class="md-nav__link">
        Scorocode.Messenger
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../JS/Scorocode.CloudCode/" title="Scorocode.CloudCode" class="md-nav__link">
        Scorocode.CloudCode
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../JS/Scorocode.Bot/" title="Scorocode.Bot" class="md-nav__link">
        Scorocode.Bot
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../JS/Scorocode.Websocket/" title="Scorocode.WebSocket" class="md-nav__link">
        Scorocode.WebSocket
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../JS/Scorocode.System/" title="Scorocode.System" class="md-nav__link">
        Scorocode.System
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      SWIFT SDK (iOs, Mac OS)
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-4">
        SWIFT SDK (iOs, Mac OS)
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../../SWIFT/SWIFT/" title="SWIFT SDK" class="md-nav__link">
        SWIFT SDK
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../SWIFT/SC/" title="SC" class="md-nav__link">
        SC
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../SWIFT/SCValue/" title="SCValue" class="md-nav__link">
        SCValue
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../SWIFT/SCObject/" title="SCObject" class="md-nav__link">
        SCObject
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../SWIFT/SCQuery/" title="SCQuery" class="md-nav__link">
        SCQuery
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../SWIFT/SCUpdate/" title="SCUpdate" class="md-nav__link">
        SCUpdate
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../SWIFT/SCUser/" title="SCUser" class="md-nav__link">
        SCUser
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../SWIFT/SCMessage/" title="SCMessage" class="md-nav__link">
        SCMessage
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../SWIFT/SCScript/" title="SCScript" class="md-nav__link">
        SCScript
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../SWIFT/SCBot/" title="SCBot" class="md-nav__link">
        SCBot
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../SWIFT/SCCollection/" title="SCCollection" class="md-nav__link">
        SCCollection
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../SWIFT/SCFolder/" title="SCFolder" class="md-nav__link">
        SCFolder
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../SWIFT/WebSocket/" title="WebSocket" class="md-nav__link">
        WebSocket
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Java SDK (Android)
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-5">
        Java SDK (Android)
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
      <a href="../Java/" title="Java SDK" class="md-nav__link">
        Java SDK
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../ScorocodeSDK/" title="Класс ScorocodeSDK" class="md-nav__link">
        Класс ScorocodeSDK
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../Document/" title="Класс Document" class="md-nav__link">
        Класс Document
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../Update/" title="Класс Update" class="md-nav__link">
        Класс Update
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../User/" title="Класс User" class="md-nav__link">
        Класс User
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../Query/" title="Класс Query" class="md-nav__link">
        Класс Query
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../Script/" title="Класс Script" class="md-nav__link">
        Класс Script
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../Message/" title="Класс Message" class="md-nav__link">
        Класс Message
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../WebSocket/" title="Класс WebSocket" class="md-nav__link">
        Класс WebSocket
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../ApplicationInfo/" title="Класс ApplicationInfo" class="md-nav__link">
        Класс ApplicationInfo
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../Bot/" title="Класс Bot" class="md-nav__link">
        Класс Bot
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../Collections/" title="Класс Collections" class="md-nav__link">
        Класс Collections
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../Folders/" title="Класс Folders" class="md-nav__link">
        Класс Folders
      </a>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../ScorocodeScript/" title="Класс ScorocodeScript" class="md-nav__link">
        Класс ScorocodeScript
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" checked>
    
    <label class="md-nav__link" for="nav-6">
      Примеры приложений
    </label>
    <nav class="md-nav" data-md-component="collapsible">
      <label class="md-nav__title" for="nav-6">
        Примеры приложений
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
  <li class="md-nav__item">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Склад (Android)
      </label>
    
    <a href="./" title="Склад (Android)" class="md-nav__link md-nav__link--active">
      Склад (Android)
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" title="Структура данных приложения:" class="md-nav__link">
    Структура данных приложения:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" title="Стартовый экран приложения." class="md-nav__link">
    Стартовый экран приложения.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" title="Экран регистрации нового пользователя" class="md-nav__link">
    Экран регистрации нового пользователя
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" title="Главный экран приложения." class="md-nav__link">
    Главный экран приложения.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" title="Экран добавления устройства" class="md-nav__link">
    Экран добавления устройства
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" title="Экран подробной информации о устройстве." class="md-nav__link">
    Экран подробной информации о устройстве.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" title="Экран информации об отгрузке товара." class="md-nav__link">
    Экран информации об отгрузке товара.
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
  <li class="md-nav__item">
    
      <a href="../../SWIFT/ToDoList/" title="Список задач (iOs)" class="md-nav__link">
        Список задач (iOs)
      </a>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" title="Структура данных приложения:" class="md-nav__link">
    Структура данных приложения:
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" title="Стартовый экран приложения." class="md-nav__link">
    Стартовый экран приложения.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" title="Экран регистрации нового пользователя" class="md-nav__link">
    Экран регистрации нового пользователя
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" title="Главный экран приложения." class="md-nav__link">
    Главный экран приложения.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_6" title="Экран добавления устройства" class="md-nav__link">
    Экран добавления устройства
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" title="Экран подробной информации о устройстве." class="md-nav__link">
    Экран подробной информации о устройстве.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" title="Экран информации об отгрузке товара." class="md-nav__link">
    Экран информации об отгрузке товара.
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
               
              
                
                <p><a name="Storehouse"></a></p>
<h1 id="_1">Приложение "Склад"</h1>
<p>Данная документация содержит описание демонстрационного приложения "Склад". Исходный код приложения доступен в репозитории <a href="https://github.com/Scorocode/scorocode-sample-storehouse">https://github.com/Scorocode/scorocode-sample-storehouse</a>.</p>
<p>Данное приложение проводит учет мобильных телефонов на складе поставщика и позволяет:</p>
<ol>
<li>Зарегистрировать нового пользователя в БД приложения</li>
<li>Провести аутентификацию пользователя приложения</li>
<li>Провести деаутентификацию пользователя приложения.</li>
<li>Посмотреть доступные модели телефонов на складе</li>
<li>Добавить модель телефона в БД</li>
<li>Удалить модель телефона из БД</li>
<li>Посмотреть подробную информацию о модели телефона</li>
<li>Изменить информацию о модели телефона</li>
<li>Выбрать интересующие модели из списка используя фильтр</li>
<li>Добавить пользователя в лист ожидания данной модели</li>
<li>Отгрузить данную модель телефона пользователю</li>
<li>Оповестить об отгрузке бухгалтерию при помощи email сообщения</li>
<li>Оповестить грузчика при помощи push сообщения.</li>
<li>Оповестить курьера при помощи sms сообщения.</li>
<li>Провести пересчет баланса фирмы с учетом отгруженных к данному моменту моделей.</li>
</ol>
<h2 id="_2">Структура данных приложения:</h2>
<p>Создана коллекция <code>storehouse</code> со следующими полями:</p>
<ol>
<li>platform (String)</li>
<li>cameraInfo (String)</li>
<li>deviceName (String)</li>
<li>colorsAvailable (Array)</li>
<li>devicePrice (Number)</li>
<li>buyers (Array)</li>
<li>lastSend (Date)</li>
<li>sendInfo (File)</li>
</ol>
<p>В системную коллекцию <code>Roles</code> добавлены 3 документа со следующими значениями поля <code>name</code> соответственно:</p>
<ol>
<li>deliveryPerson</li>
<li>accountantPerson</li>
<li>loaderPerson</li>
</ol>
<h2 id="_3">Стартовый экран приложения.</h2>
<p>Создадим стартовый экран приложения с именем <code>LoginActivity</code>. Для этого в Android Studio выберем <code>File → New → Activity → Empty Activity</code> и в layout-файл данной активности добавим следующий код:</p>
<p><pre class="codehilite"><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;RelativeLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    xmlns:tools=&quot;http://schemas.android.com/tools&quot;
    android:id=&quot;@+id/activity_login&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;
    android:paddingBottom=&quot;@dimen/activity_vertical_margin&quot;
    android:paddingLeft=&quot;@dimen/activity_horizontal_margin&quot;
    android:paddingRight=&quot;@dimen/activity_horizontal_margin&quot;
    android:paddingTop=&quot;@dimen/activity_vertical_margin&quot;
    tools:context=&quot;prof_itgroup.ru.storehouseapp.Activities.LoginActivity&quot;&gt;
    &lt;LinearLayout
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:gravity=&quot;center&quot;
        android:orientation=&quot;vertical&quot;&gt;
        &lt;TextView
            style=&quot;@style/label_style&quot;
            android:layout_marginTop=&quot;16dp&quot;
            android:text=&quot;@string/login&quot; /&gt;
        &lt;EditText
            android:id=&quot;@+id/etEmail&quot;
            android:gravity=&quot;center&quot;
            style=&quot;@style/textStyle&quot;
            android:hint=&quot;@string/login_hint&quot; /&gt;
        &lt;TextView
            style=&quot;@style/label_style&quot;
            android:layout_marginTop=&quot;16dp&quot;
            android:text=&quot;@string/password&quot;/&gt;
        &lt;EditText
            android:gravity=&quot;center&quot;
            android:id=&quot;@+id/etPassword&quot;
            style=&quot;@style/textStyle&quot;
            android:hint=&quot;@string/password_hint&quot;
            android:inputType=&quot;textPassword&quot;
            android:maxLines=&quot;1&quot; /&gt;
        &lt;LinearLayout
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:gravity=&quot;center_horizontal&quot;
            android:orientation=&quot;vertical&quot;&gt;
            &lt;Button
                android:id=&quot;@+id/btnLogin&quot;
                android:layout_width=&quot;match_parent&quot;
                android:layout_height=&quot;wrap_content&quot;
                android:layout_marginTop=&quot;4dp&quot;
                android:text=&quot;@string/login_button_text&quot; /&gt;
            &lt;Button
                android:id=&quot;@+id/btnRegister&quot;
                android:layout_width=&quot;match_parent&quot;
                android:layout_height=&quot;wrap_content&quot;
                android:layout_marginTop=&quot;4dp&quot;
                android:text=&quot;@string/register_button_text&quot; /&gt;
        &lt;/LinearLayout&gt;
    &lt;/LinearLayout&gt;
&lt;/RelativeLayout&gt;</code></pre>
Стартовый экран приложения, соответствующий классу <code>LoginActivity</code>, показан на рисунке 1.1. </p>
<p><img alt="Cтартовый экран приложения" src="../img/Storehouse/1.1.png" /></p>
<p>Рисунок 1.1 – стартовый экран приложения.</p>
<p>В метод <code>onCreate</code> класса <code>LoginActivity</code> добавим следующий код:</p>
<pre class="codehilite"><code class="language-Java">@Override
protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    setContentView(R.layout.activity_login);
    if (isUserLogined(this)) {
        MainActivity.display(this);
    }
    ScorocodeSdk.initWith(APPLICATION_ID, CLIENT_KEY, null, FILE_KEY, MESSAGE_KEY, SCRIPT_KEY, null);
    ButterKnife.bind(this);
}</code></pre>

<p>В методе <code>onCreate</code> данного класса происходит инициализация <code>ScorocodeSdk</code> ключами <code>appId</code>, <code>clientKey</code> (android), <code>fileKey</code>, <code>messageKey</code>, <code>scriptKey</code> при помощи метода <code>ScorocodeSdk.initWith(...)</code>; Посмотреть данные ключи можно на вкладке «Безопасность» настроек проекта.</p>
<p>На данном экране пользователь БД может ввести свой логин и пароль и системе. Приложения проведет проверку правильности введенных данных при помощи метода <code>.login()</code> класса <code>User</code>. Использование данного метода показано в листинге:</p>
<pre class="codehilite"><code class="language-Java">@OnClick(R.id.btnLogin)
public void onBtnLoginClicked() {
    User user = new User();
    user.login(etEmail.getText().toString(), etPassword.getText().toString(), new CallbackLoginUser() {
        @Override
        public void onLoginSucceed(ResponseLogin responseLogin) {
            DocumentInfo userInfo = responseLogin.getResult().getUserInfo();
            saveUserInfo(userInfo);
            MainActivity.display(LoginActivity.this);
        }
        @Override
        public void onLoginFailed(String errorCode, String errorMessage) {
            Helper.showToast(getBaseContext(), R.string.error_login);
        }
    });
}</code></pre>

<p>В данном методе мы создаем новый экземпляр класса <code>User</code> и вызываем его метод <code>login</code> при этом информацию о email и password пользователя мы берем из соответствующих <code>EditText</code>. Метод <code>login</code> проверит тот факт, что пользователь с таким email и паролем существует в коллекции «users».</p>
<p>В случае если в коллекции «users» имеется пользователь с указанными email и password, то будет выполнен метод <code>onLoginSucceed(...) callback</code> интерфейса иначе - <code>onFoginFailed(...)</code>. Таким образом мы можем удостовериться в наличии пользователя с такими данными в нашей БД и принять дальнейшие действия.</p>
<p>На стартовом экране (показанном на рисунке 1.1) так же имеется кнопка «Зарегистрировать» позволяющая зарегистрировать нового пользователя в системе (добавить его в коллекцию «users» БД). Привяжем к данной кнопке обработчик нажатия который открывает активность с данными для регистрации пользователя:</p>
<pre class="codehilite"><code class="language-Java">@OnClick(R.id.btnRegister)
public void onBtnRegisterClicked() {
    RegisterActivity.display(this);
}</code></pre>

<h2 id="_4">Экран регистрации нового пользователя</h2>
<p>Создадим новую активность с именем <code>RegisterActivity</code> и добавим в layout-файл данной активности следующий xml код:</p>
<p><pre class="codehilite"><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    xmlns:tools=&quot;http://schemas.android.com/tools&quot;
    android:id=&quot;@+id/activity_register&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;
    android:gravity=&quot;center_horizontal&quot;
    android:orientation=&quot;vertical&quot;
    android:paddingBottom=&quot;@dimen/activity_vertical_margin&quot;
    android:paddingLeft=&quot;@dimen/activity_horizontal_margin&quot;
    android:paddingRight=&quot;@dimen/activity_horizontal_margin&quot;
    android:paddingTop=&quot;@dimen/activity_vertical_margin&quot;
    tools:context=&quot;prof_itgroup.ru.storehouseapp.Activities.RegisterActivity&quot;&gt;
    &lt;TextView
        style=&quot;@style/label_style&quot;
        android:text=&quot;@string/register_username&quot; /&gt;
    &lt;EditText
        android:id=&quot;@+id/etUsername&quot;
        style=&quot;@style/textStyle&quot;
        android:hint=&quot;@string/register_username_hint&quot;/&gt;
    &lt;TextView
        android:layout_marginTop=&quot;16dp&quot;
        style=&quot;@style/label_style&quot;
        android:text=&quot;@string/register_email&quot; /&gt;
    &lt;EditText
        android:id=&quot;@+id/etEmail&quot;
        style=&quot;@style/textStyle&quot;
        android:hint=&quot;@string/register_email_hint&quot;/&gt;
    &lt;TextView
        android:layout_marginTop=&quot;16dp&quot;
        style=&quot;@style/label_style&quot;
        android:text=&quot;@string/register_password&quot; /&gt;
    &lt;EditText
        android:id=&quot;@+id/etPassword&quot;
        style=&quot;@style/textStyle&quot;
        android:inputType=&quot;textPassword&quot;
        android:hint=&quot;@string/register_email_password&quot;/&gt;
    &lt;EditText
        android:id=&quot;@+id/etPasswordCheck&quot;
        style=&quot;@style/textStyle&quot;
        android:inputType=&quot;textPassword&quot;
        android:hint=&quot;@string/register_email_password_again&quot;/&gt;
    &lt;Button
        android:layout_marginTop=&quot;32dp&quot;
        android:id=&quot;@+id/btnRegister&quot;
        style=&quot;@style/textStyle&quot;
        android:text=&quot;@string/btn_register_text&quot;/&gt;
&lt;/LinearLayout&gt;</code></pre>
Данная активность представляет собой экран регистрации нового пользователя, показанный на рисунке 1.2</p>
<p><img alt="Экран регистрации нового пользователя" src="../img/Storehouse/1.2.png" /></p>
<p>Рисунок 1.2 — экран регистрации нового пользователя.</p>
<p>На данном экране вводятся все необходимые поля документа (характеризующие пользователя). Добавим обработчик нажатия для кнопки «Зарегистрировать» вызывающий метод <code>.register</code> класса <code>User</code> для регистрации нового пользователя, показанный ниже:</p>
<pre class="codehilite"><code class="language-Java">@OnClick(R.id.btnRegister)
public void onBtnRegisterClicked() {
    String userName = etUsername.getText().toString();
    String email = etEmail.getText().toString();
    String password = etPassword.getText().toString();
    String passwordCheck = etPasswordCheck.getText().toString();

    if(isInputValid(userName, email, password, passwordCheck)) {
        new User().register(userName, email, password, new CallbackRegisterUser() {
            @Override
            public void onRegisterSucceed() {
                Toast.makeText(RegisterActivity.this, getResources().getString(R.string.register_succeed), Toast.LENGTH_SHORT).show();
                LoginActivity.display(RegisterActivity.this);
            }
            @Override
            public void onRegisterFailed(String errorCode, String errorMessage) {
                Toast.makeText(RegisterActivity.this, getResources().getString(R.string.error_register), Toast.LENGTH_SHORT).show();
            }
        });
    } else {
        Toast.makeText(this, getResources().getString(R.string.wrong_data) , Toast.LENGTH_SHORT).show();
    }
}</code></pre>

<p>В данном методе мы получаем значения введенные в элементы <code>EditText</code>, а именно: имя пользователя, его email, пароль и пароль повторно (для проверки).</p>
<p>Далее при помощи метода isInputValid мы проверяем, что поля не являются пустыми и что значение, введенное в поля пароля и проверки пароля идентичны, после чего вызываем метод <code>.register</code> класса <code>User</code>.</p>
<p>В случае если регистрация пользователя прошла успешно (т.е если sdk инициализирован, все ключи указаны правильно и нет конфликта с уже существующими пользователями), будет выполнен метод  <code>onRegisterSucceed(...) callback</code> интерфейса иначе будет выполнен метод <code>onRegisterFailed(...)</code>.</p>
<p>В данном случае при успешной регистрации пользователя выдается Toast-сообщение с информацией о том, что пользователь успешно зарегистрирован и открывается активность <code>LoginActivity</code> чтобы пользователь мог аутентифицироваться и приступить к работе с приложением.</p>
<h2 id="_5">Главный экран приложения.</h2>
<p>Создадим главный экран приложения с именем <code>MainActivity</code> и в layout-файл данной активности добавим следующий xml код:</p>
<pre class="codehilite"><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;RelativeLayout
    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    xmlns:tools=&quot;http://schemas.android.com/tools&quot;
    android:id=&quot;@+id/activity_main&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;
    android:paddingLeft=&quot;@dimen/activity_horizontal_margin&quot;
    android:paddingRight=&quot;@dimen/activity_horizontal_margin&quot;
    android:paddingTop=&quot;@dimen/activity_vertical_margin&quot;
    android:paddingBottom=&quot;@dimen/activity_vertical_margin&quot;
    tools:context=&quot;prof_itgroup.ru.storehouseapp.Activities.MainActivity&quot;&gt;
    &lt;ListView
        android:id=&quot;@+id/lvItemsInStorehouse&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;/&gt;
&lt;/RelativeLayout&gt;</code></pre>

<p>Активность представляет собой <code>ListView</code> в который мы передаем информацию о товарах, хранящихся в БД. Кроме того активность содержит иконки <code>ActionBar</code> о которых будет сказано подробней.</p>
<p>Для отображения информации создадим адаптер с именем <code>StoreItemAdapter</code> код которого показан ниже:</p>
<pre class="codehilite"><code class="language-Java">package prof_itgroup.ru.storehouseapp.Objects;
import android.content.Context;
import android.support.annotation.NonNull;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.BaseAdapter;
import android.widget.TextView;
import java.util.List;
import butterknife.BindView;
import butterknife.ButterKnife;
import prof_itgroup.ru.storehouseapp.Activities.ItemDetailsActivity;
import prof_itgroup.ru.storehouseapp.R;
import ru.profit_group.scorocode_sdk.scorocode_objects.DocumentInfo;

public class StoredItemsAdapter extends BaseAdapter {
    private Context context;
    private List&lt;DocumentInfo&gt; storedItems;
    private int layoutId;
    private LayoutInflater inflater;
    private DocumentFields fields;
    public StoredItemsAdapter(Context context, @NonNull List&lt;DocumentInfo&gt; storedItems, int layoutId) {
        this.context = context;
        this.storedItems = storedItems;
        this.layoutId = layoutId;
        inflater = LayoutInflater.from(context);
        fields = new DocumentFields(context, null);
    }
    @Override
    public int getCount() {
        return storedItems.size();
    }
    @Override
    public Object getItem(int position) {
        return storedItems.get(position);
    }
    @Override
    public long getItemId(int position) {
        return position;
    }
    @Override
    public View getView(int position, View view, ViewGroup parent) {
        ViewHolder holder;
        if (view != null) {
            holder = (ViewHolder) view.getTag();
        } else {
            view = inflater.inflate(layoutId, parent, false);
            holder = new ViewHolder(view);
            view.setTag(holder);
        }
        customizeView(view, holder, storedItems.get(position));
        return view;
    }
    private void customizeView(View view, ViewHolder holder, final DocumentInfo documentInfo) {
        String deviceName = (String) documentInfo.getFields().get(fields.getDeviceNameField());
        String devicePlatform = (String) documentInfo.getFields().get(fields.getPlatformField());
        Double devicePrice = (Double) documentInfo.getFields().get(fields.getDevicePriceField());
        holder.tvStoredItemName.setText(deviceName);
        holder.tvStoredItemStatus.setText(devicePlatform);
        holder.tvStoredItemPrice.setText(String.valueOf(devicePrice));
        view.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                ItemDetailsActivity.display(context, documentInfo);
            }
        });
    }
    static class ViewHolder {
        @BindView(R.id.tvStoredItemName) TextView tvStoredItemName;
        @BindView(R.id.tvStoredItemPlatform) TextView tvStoredItemStatus;
        @BindView(R.id.tvStoredItemPrice) TextView tvStoredItemPrice;
        public ViewHolder(View view) {
            ButterKnife.bind(this, view);
        }
    }
}</code></pre>

<p>В качестве элемента списка используем следующий layout-файл:</p>
<pre class="codehilite"><code class="language-xml"> &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;RelativeLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;
    android:orientation=&quot;horizontal&quot;
    android:padding=&quot;8dp&quot;&gt;
    &lt;TextView
        android:id=&quot;@+id/tvStoredItemName&quot;
        style=&quot;@style/textStyle&quot;
        android:layout_alignParentLeft=&quot;true&quot;
        android:layout_toLeftOf=&quot;@+id/tvStoredItemPlatform&quot;
        android:text=&quot;@string/storedItemName&quot; /&gt;
    &lt;TextView
        android:id=&quot;@+id/tvStoredItemPlatform&quot;
        style=&quot;@style/textStyle&quot;
        android:layout_marginRight=&quot;32dp&quot;
        android:layout_toLeftOf=&quot;@+id/tvStoredItemPrice&quot;
        android:text=&quot;@string/storedItemStatus&quot; /&gt;
    &lt;TextView
        android:id=&quot;@+id/tvStoredItemPrice&quot;
        style=&quot;@style/textStyle&quot;
        android:layout_alignParentRight=&quot;true&quot;
        android:text=&quot;@string/storedItemPrice&quot; /&gt;
&lt;/RelativeLayout&gt;</code></pre>

<p>Данные о товарах, хранящихся в БД мы будем получать в методе <code>onResume()</code> активности <code>MainActivity</code>. Для этого в метод <code>onResume</code> добавим следующий код:</p>
<pre class="codehilite"><code class="language-Java">@Override
protected void onResume() {
    super.onResume();
    Query query = new Query(COLLECTION_NAME);
    query.findDocuments(new CallbackFindDocument() {
        @Override
        public void onDocumentFound(List&lt;DocumentInfo&gt; documentInfos) {
            if(documentInfos != null) {
                setAdapter(documentInfos);
            }
        }
        @Override
        public void onDocumentNotFound(String errorCode, String errorMessage) {
            Toast.makeText(MainActivity.this, getResources().getString(R.string.error_get_docs), Toast.LENGTH_SHORT).show();
        }
    });
}</code></pre>

<p>В данном коде мы создаем экземпляр объекта <code>Query</code> не задавая параметров (т.е выбираем первые 100 документов из данной коллекции) и далее с помощью метода findDocument получаем документы из нашей коллекции.</p>
<p>В случае если удалось найти документы мы устанавливаем адаптер, иначе выдаем сообщение об ошибке.</p>
<p>Так же добавим необходимые иконки в <code>ActionBar</code> активности. Для этого создадим <code>layout</code> файл <code>main_activity_menu</code> и добавим туда следующий xml код:</p>
<pre class="codehilite"><code class="language-xml">&lt;menu xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;&gt;
    &lt;item
        android:id=&quot;@+id/action_add_item&quot;
        android:icon=&quot;@drawable/ic_create_new_folder_white_24dp&quot;
        android:title=&quot;@string/action_add_item&quot;
        app:showAsAction=&quot;always&quot;/&gt;
    &lt;item
        android:id=&quot;@+id/action_set_filter&quot;
        android:icon=&quot;@drawable/ic_filter_list_white_24dp&quot;
        android:title=&quot;@string/action_filter_item&quot;
        app:showAsAction=&quot;ifRoom&quot;/&gt;
    &lt;item
        android:id=&quot;@+id/action_logout&quot;
        android:icon=&quot;@drawable/ic_exit_to_app_white_24dp&quot;
        android:title=&quot;@string/action_logout_item&quot;
        app:showAsAction=&quot;ifRoom&quot;/&gt;

&lt;/menu&gt;</code></pre>

<p>Т.е в <code>ActionBar</code> мы будем отображать иконки «Добавить элемент в БД», «Установить фильтр» и «Завершить активную сессию пользователя» (logout). На экран активности данные иконки добавим при помощи следующего метода:</p>
<pre class="codehilite"><code class="language-Java">@Override
public boolean onCreateOptionsMenu(Menu menu) {
    getMenuInflater().inflate(R.menu.main_activity_menu, menu);
    return super.onCreateOptionsMenu(menu);
}</code></pre>

<p>Обрабатывать нажатия на иконки будем при помощи метода показанного ниже</p>
<pre class="codehilite"><code class="language-Java">@Override
public boolean onOptionsItemSelected(MenuItem item) {
    switch (item.getItemId()) {
        case R.id.action_add_item:
            AddItemActivity.display(this);
            break;

        case R.id.action_set_filter:
            new FilterDialog(this).showFilterDialog(new FilterDialog.CallbackFilterDialog() {
                @Override
                public void onFilterApplied(List&lt;DocumentInfo&gt; documentInfo) {
                    setAdapter(documentInfo);
                }
            });
            break;

        case R.id.action_logout:
            LoginActivity.logout(this);
            break;
    }
    return super.onOptionsItemSelected(item);
}</code></pre>

<p>Готовый экран данной активности показан на рисунке 2.1</p>
<p><img alt="главный экран приложения" src="../img/Storehouse/2.1.png" /></p>
<p>Рисунок 2.1 — главный экран приложения.</p>
<p>На данном экране показаны текущие модели телефонов, присутствующие на складе. В верхнем правом углу экрана показаны следующие иконки:</p>
<p><img alt="Добавить новую модель в базу данных" src="../img/Storehouse/2.1.1.png" /> - Добавить новую модель в базу данных.</p>
<p><img alt="Применить фильтр к списку устройств" src="../img/Storehouse/2.1.2.png" /> - Применить фильтр к списку устройств.</p>
<p><img alt="Закончить активную сессию пользователя" src="../img/Storehouse/2.1.3.png" /> - Закончить активную сессию пользователя (logout).  </p>
<p>При нажатии на кнопку <img alt="Добавить новую модель в базу данных" src="../img/Storehouse/2.1.1.png" />  пользователь переходит на экран добавления устройства в БД.</p>
<h2 id="_6">Экран добавления устройства</h2>
<p>Создадим активность с именем <code>AddItemActivity</code> и добавим в её layout-файл следующий xml код:</p>
<pre class="codehilite"><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    xmlns:tools=&quot;http://schemas.android.com/tools&quot;
    android:id=&quot;@+id/activity_add_item&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;
    android:orientation=&quot;vertical&quot;
    android:padding=&quot;8dp&quot;
    tools:context=&quot;prof_itgroup.ru.storehouseapp.Activities.AddItemActivity&quot;&gt;
    &lt;ScrollView
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;&gt;
        &lt;include layout=&quot;@layout/item_core&quot;/&gt;
    &lt;/ScrollView&gt;
&lt;/LinearLayout&gt;</code></pre>

<p>В свою очередь, включаемый файл item_core.xml представляет собой:</p>
<pre class="codehilite"><code class="language-xml">&lt;LinearLayout android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;wrap_content&quot;
    android:orientation=&quot;vertical&quot;
    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;
    &lt;TextView
        style=&quot;@style/label_style&quot;
        android:text=&quot;@string/add_item_device_name&quot; /&gt;
    &lt;EditText
        android:id=&quot;@+id/etDeviceName&quot;
        style=&quot;@style/textStyle&quot;
        android:hint=&quot;@string/add_item_hint_device_name&quot; /&gt;
    &lt;TextView
        style=&quot;@style/label_style&quot;
        android:text=&quot;@string/add_item_device_platform&quot; /&gt;
    &lt;EditText
        android:id=&quot;@+id/etDevicePlatform&quot;
        style=&quot;@style/textStyle&quot;
        android:hint=&quot;@string/add_item_hint_device_platform&quot; /&gt;
    &lt;TextView
        style=&quot;@style/label_style&quot;
        android:text=&quot;@string/add_item_camera_info&quot; /&gt;
    &lt;EditText
        android:id=&quot;@+id/etDeviceCameraInfo&quot;
        style=&quot;@style/textStyle&quot;
        android:hint=&quot;@string/add_item_hint_camera_info&quot; /&gt;
    &lt;TextView
        style=&quot;@style/label_style&quot;
        android:text=&quot;@string/add_item_available_colors_info&quot; /&gt;
    &lt;EditText
        android:id=&quot;@+id/etDeviceColors&quot;
        style=&quot;@style/textStyle&quot;
        android:hint=&quot;@string/add_item_hint_available_colors_info&quot; /&gt;
    &lt;LinearLayout
        android:id=&quot;@+id/llChangeColorList&quot;
        android:visibility=&quot;gone&quot;
        android:gravity=&quot;center_horizontal&quot;
        android:orientation=&quot;horizontal&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;&gt;
        &lt;Button
            android:id=&quot;@+id/btnAddColor&quot;
            android:padding=&quot;12dp&quot;
            android:layout_marginRight=&quot;8dp&quot;
            android:text=&quot;@string/add_color&quot;
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot; /&gt;
        &lt;Button
            android:id=&quot;@+id/btnRemoveColor&quot;
            android:padding=&quot;12dp&quot;
            android:layout_marginLeft=&quot;8dp&quot;
            android:text=&quot;@string/remove_color&quot;
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot; /&gt;
    &lt;/LinearLayout&gt;
    &lt;TextView
        style=&quot;@style/label_style&quot;
        android:text=&quot;@string/add_item_price&quot; /&gt;
    &lt;EditText
        android:id=&quot;@+id/etDevicePrice&quot;
        style=&quot;@style/textStyle&quot;
        android:inputType=&quot;number&quot;
        android:hint=&quot;@string/add_item_hint_available_amount_info&quot; /&gt;
    &lt;LinearLayout
        android:id=&quot;@+id/llChangePrice&quot;
        android:visibility=&quot;gone&quot;
        android:gravity=&quot;center_horizontal&quot;
        android:orientation=&quot;horizontal&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;&gt;
        &lt;Button
            android:id=&quot;@+id/btnIncreaseCount&quot;
            android:padding=&quot;8dp&quot;
            android:layout_marginRight=&quot;8dp&quot;
            android:text=&quot;@string/increase_item_count&quot;
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot; /&gt;
        &lt;Button
            android:id=&quot;@+id/btnDecreaseCount&quot;
            android:padding=&quot;8dp&quot;
            android:layout_marginLeft=&quot;8dp&quot;
            android:text=&quot;@string/decrease_item_count&quot;
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot; /&gt;
    &lt;/LinearLayout&gt;
    &lt;LinearLayout
        android:orientation=&quot;vertical&quot;
        android:gravity=&quot;center&quot;
        android:layout_gravity=&quot;center&quot;
        android:layout_width=&quot;200dp&quot;
        android:layout_height=&quot;wrap_content&quot;
        android:weightSum=&quot;1&quot;&gt;
        &lt;Button
            android:id=&quot;@+id/btnAddItem&quot;
            android:padding=&quot;8dp&quot;
            android:background=&quot;#64b5f6&quot;
            android:textColor=&quot;@android:color/white&quot;
            android:layout_width=&quot;match_parent&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:layout_gravity=&quot;center_horizontal&quot;
            android:layout_marginTop=&quot;8dp&quot;
            android:text=&quot;@string/add&quot; /&gt;
        &lt;Button
            android:id=&quot;@+id/btnClear&quot;
            android:padding=&quot;8dp&quot;
            android:background=&quot;#64b5f6&quot;
            android:textColor=&quot;@android:color/white&quot;
            android:layout_width=&quot;match_parent&quot;
            android:layout_height=&quot;wrap_content&quot;
            android:layout_gravity=&quot;center_horizontal&quot;
            android:layout_marginTop=&quot;8dp&quot;
            android:text=&quot;@string/button_clear&quot;
            android:layout_weight=&quot;0.22&quot; /&gt;
    &lt;/LinearLayout&gt;
&lt;/LinearLayout&gt;</code></pre>

<p>Итоговый вид активности показан на рисунке 2.2</p>
<p><img alt="Экран добавления нового устройства в БД" src="../img/Storehouse/2.2.png" /></p>
<p>Рисунок 2.2 — Экран добавления нового устройства в БД.</p>
<p>На этом экране пользователь вводит всю необходиму информацию о устройстве и нажимает кнопку «ДОБАВИТЬ». При этом программа создает новый документ, заполняет его поля и сохраняет на сервере.  Добавим данные действия: зададим обработчик нажатия кнопки «Добавить» который будет вызывать метод показанный ниже:</p>
<pre class="codehilite"><code class="language-Java">@OnClick(R.id.btnAddItem)
public void onBtnAddItemClicked() {
    Document document = new Document(MainActivity.COLLECTION_NAME);
    if (isAllFieldsFilled()) {
        document.setField(fields.getDeviceNameField(), getStringFrom(etDeviceName).trim());
        document.setField(fields.getPlatformField(), getStringFrom(etDevicePlatform).trim());
        document.setField(fields.getCameraInfoField(), getStringFrom(etDeviceCameraInfo).trim());
        document.setField(fields.getColorsAvailableField(), getColorsListFrom(getStringFrom(etDeviceColors)));
        document.setField(fields.getDevicePriceField(), Double.valueOf(getStringFrom(etDevicePrice)));
        document.saveDocument(new CallbackDocumentSaved() {
            @Override
            public void onDocumentSaved() {
                Toast.makeText(AddItemActivity.this, getString(R.string.succed_add_item), Toast.LENGTH_SHORT).show();
                finish();
            }

            @Override
            public void onDocumentSaveFailed(String errorCode, String errorMessage) {
                Toast.makeText(AddItemActivity.this, getString(R.string.error_add_item), Toast.LENGTH_SHORT).show();
            }
        });
    } else {
        Toast.makeText(this, getString(R.string.wrong_data), Toast.LENGTH_SHORT).show();
    }
}</code></pre>

<p>В данном методе мы создаем экземпляр класса <code>Document</code>, проверяем заполнил ли пользователь всю информацию в соответствующих <code>EditText</code> и устанавливаем поля документа при помощи метода <code>setField(…)</code> после чего сохраняем документ. Поскольку документ создан без ассоциации с реальным документом из БД (т.е без использования метода <code>getDocumentById()</code>, то новый документ с указанными полями будет загружен на сервер.</p>
<p>Документы хранятся в БД Scorocode в виде показанном на рисунке 2.3</p>
<p><img alt="храниение документов в коллекции БД Scorocode" src="../img/Storehouse/2.3.png" /></p>
<p>Рисунок 2.3 — храниение документов в коллекции БД Scorocode.</p>
<p>Каждый документ содержит системные и пользовательские поля.
Системными являются:</p>
<ol>
<li>id — уникальный идентификатор документа в коллекции</li>
<li>readACL — права на чтения данного документа.</li>
<li>updateACL — права на обновление данного документа.</li>
<li>removeACL — права на удаление данного документа.</li>
<li>createdAt — время создания документа.</li>
<li>updatedAt - время последнего обновления документа.</li>
</ol>
<p>Пользователь может добавлять другие поля по своему усмотрению используя кнопку «Добавить поле» на верхней панели. Пользователь так же может добавить документ нажав кнопку «Добавить документ» на верхней панели и введя значения полей вручную. Более подробно о функциональности верхней панели БД см.документацию Scorocode.</p>
<p>При нажатии на кнопку <img alt="Применить фильтр к списку устройств" src="../img/Storehouse/2.1.2.png" /> пользователь попадает в диалоговое окно фильтра.</p>
<p>Создадим данное диалоговое окно. Для этого создадим класс <code>FilterDialog</code> код которого показан ниже:</p>
<pre class="codehilite"><code class="language-Java">package prof_itgroup.ru.storehouseapp.Objects;
import android.content.Context;
import android.content.DialogInterface;
import android.support.v7.app.AlertDialog;
import android.view.LayoutInflater;
import android.view.View;
import android.widget.CheckBox;
import android.widget.EditText;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;
import butterknife.ButterKnife;
import prof_itgroup.ru.storehouseapp.Activities.MainActivity;
import prof_itgroup.ru.storehouseapp.Helpers.Helper;
import prof_itgroup.ru.storehouseapp.R;
import ru.profit_group.scorocode_sdk.Callbacks.CallbackFindDocument;
import ru.profit_group.scorocode_sdk.scorocode_objects.DocumentInfo;
import ru.profit_group.scorocode_sdk.scorocode_objects.Query;

public class FilterDialog {
    private Context context;
    public FilterDialog(Context context) {
        this.context = context;
    }
    public void showFilterDialog(final CallbackFilterDialog callbackFilterDialog) {
        final View v = LayoutInflater.from(context).inflate(R.layout.filter_layout, null);
        final CheckBox cbPriceFilter = ButterKnife.findById(v, R.id.cbPriceFilter);
        final CheckBox cbPlatformFilter = ButterKnife.findById(v, R.id.cbPlatformFilter);
        final CheckBox cbColourFilter = ButterKnife.findById(v, R.id.cbColorFilter);
        final EditText etPlatformFilter = ButterKnife.findById(v, R.id.etPlatformFilter);
        final EditText etColors = ButterKnife.findById(v, R.id.etColors);
        AlertDialog.Builder builder = new AlertDialog.Builder(context)
                .setTitle(R.string.titleChooseFilterProperties)
                .setPositiveButton(R.string.continue_action, new DialogInterface.OnClickListener() {
                    @Override
                    public void onClick(DialogInterface dialog, int which) {
                        Query query = new Query(MainActivity.COLLECTION_NAME);
                        if (cbPriceFilter.isChecked()) {
                            setPriceFilter(v, query);
                        }
                        if (cbPlatformFilter.isChecked()) {
                            query.equalTo(new DocumentFields(context).getPlatformField(), etPlatformFilter.getText().toString());
                        }
                        if(cbColourFilter.isChecked()) {
                            List&lt;Object&gt; colors = new ArrayList&lt;&gt;();
                            colors.addAll(Arrays.asList(Helper.getStringFrom(etColors).split(&quot;,&quot;)));
                            query.containedIn(new DocumentFields(context).getColorsAvailableField(), colors);
                        }
                        query.findDocuments(new CallbackFindDocument() {
                            @Override
                            public void onDocumentFound(List&lt;DocumentInfo&gt; documentInfos) {
                                 callbackFilterDialog.onFilterApplied(documentInfos);
                            }
                            @Override
                            public void onDocumentNotFound(String errorCode, String errorMessage) {
                                Helper.showToast(context, R.string.error);
                            }
                        });
                    }
                }).setView(v);
        builder.show();
    }
    private void setPriceFilter(View view, Query query) {
        String priceField = new DocumentFields(view.getContext()).getDevicePriceField();
        final CheckBox cbIncludeLower = ButterKnife.findById(view, R.id.cbIncludeLower);
        final CheckBox cbIncludeUpper = ButterKnife.findById(view, R.id.cbIncludeUpper);
        final EditText etLowerPrice = ButterKnife.findById(view, R.id.etPriceFrom);
        final EditText etUpperPrice = ButterKnife.findById(view, R.id.etPriceTo);
        if(cbIncludeLower.isChecked()) {
            query.greaterThenOrEqualTo(priceField, getPrice(etLowerPrice));
        } else {
            query.greaterThan(priceField, getPrice(etLowerPrice));
        }
        if(cbIncludeUpper.isChecked()) {
            query.lessThanOrEqualTo(priceField, getPrice(etUpperPrice));
        } else {
            query.lessThan(priceField, getPrice(etUpperPrice));
        }
    }
    private Double getPrice(EditText etPrice) {
        String price = etPrice.getText().toString();
        Double priceDouble = 0d;
        if(!price.isEmpty()) {
            priceDouble = Double.valueOf(price);
        }
        return priceDouble;
    }
    public interface CallbackFilterDialog {
        void onFilterApplied(List&lt;DocumentInfo&gt; documentInfo);
    }
}</code></pre>

<p>В методе <code>showFilterDialog</code> мы создаем <code>AlertDialog</code> и задаем ему <code>View</code> из следующего layout-файла:</p>
<pre class="codehilite"><code class="language-xml"> &lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    android:orientation=&quot;vertical&quot;
    android:padding=&quot;16dp&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;&gt;
    &lt;include layout=&quot;@layout/price_filter_layout&quot; /&gt;

    &lt;include layout=&quot;@layout/dilimeter&quot; /&gt;

    &lt;include layout=&quot;@layout/platform_filter&quot; /&gt;

    &lt;include layout=&quot;@layout/dilimeter&quot; /&gt;

    &lt;LinearLayout
        android:orientation=&quot;horizontal&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;&gt;
        &lt;CheckBox
            android:id=&quot;@+id/cbColorFilter&quot;
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot; /&gt;
        &lt;TextView
            android:text=&quot;@string/colorsFilter&quot;
            style=&quot;@style/label_style&quot;/&gt;
        &lt;EditText
            android:id=&quot;@+id/etColors&quot;
            android:layout_marginLeft=&quot;16dp&quot;
            android:hint=&quot;@string/color_filter_hint&quot;
            style=&quot;@style/label_style&quot; /&gt;
    &lt;/LinearLayout&gt;
&lt;/LinearLayout&gt;</code></pre>

<p>Включаемые layout-файлы <code>price_filter_layout</code> и <code>platform_filter</code> показаны ниже:</p>
<pre class="codehilite"><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    xmlns:tools=&quot;http://schemas.android.com/tools&quot;
    android:orientation=&quot;vertical&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;wrap_content&quot;
    tools:showIn=&quot;@layout/filter_layout&quot;&gt;
    &lt;LinearLayout
        android:orientation=&quot;horizontal&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;&gt;
        &lt;CheckBox
            android:id=&quot;@+id/cbPriceFilter&quot;
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot; /&gt;
        &lt;TextView
            android:layout_marginLeft=&quot;8dp&quot;
            android:layout_marginStart=&quot;8dp&quot;
            android:text=&quot;@string/filter_price_from&quot;
            style=&quot;@style/label_style&quot; /&gt;
        &lt;EditText
            android:id=&quot;@+id/etPriceFrom&quot;
            android:layout_marginLeft=&quot;4dp&quot;
            android:layout_marginStart=&quot;4dp&quot;
            android:minWidth=&quot;60dp&quot;
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot; /&gt;
        &lt;TextView
            android:text=&quot;@string/filter_price_up_to&quot;
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot; /&gt;
        &lt;EditText
            android:id=&quot;@+id/etPriceTo&quot;
            android:layout_marginLeft=&quot;4dp&quot;
            android:layout_marginStart=&quot;4dp&quot;
            android:minWidth=&quot;60dp&quot;
            style=&quot;@style/label_style&quot;/&gt;
    &lt;/LinearLayout&gt;
    &lt;RelativeLayout
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;&gt;
        &lt;LinearLayout
            android:id=&quot;@+id/llLowerBound&quot;
            android:layout_marginLeft=&quot;32dp&quot;
            android:layout_alignParentLeft=&quot;true&quot;
            android:orientation=&quot;horizontal&quot;
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot;&gt;
            &lt;CheckBox
                android:id=&quot;@+id/cbIncludeLower&quot;
                android:layout_width=&quot;wrap_content&quot;
                android:layout_height=&quot;wrap_content&quot; /&gt;
            &lt;TextView
                android:layout_gravity=&quot;fill&quot;
                android:text=&quot;@string/include_lower&quot;
                style=&quot;@style/label_style&quot; /&gt;
        &lt;/LinearLayout&gt;
        &lt;LinearLayout
            android:layout_marginLeft=&quot;160dp&quot;
            android:orientation=&quot;horizontal&quot;
            android:layout_width=&quot;wrap_content&quot;
            android:layout_height=&quot;wrap_content&quot;&gt;
            &lt;CheckBox
                android:id=&quot;@+id/cbIncludeUpper&quot;
                android:layout_width=&quot;wrap_content&quot;
                android:layout_height=&quot;wrap_content&quot; /&gt;
            &lt;TextView
                android:layout_gravity=&quot;fill&quot;
                android:text=&quot;@string/include_upper&quot;
                style=&quot;@style/label_style&quot; /&gt;
        &lt;/LinearLayout&gt;
    &lt;/RelativeLayout&gt;
&lt;/LinearLayout&gt;</code></pre>

<pre class="codehilite"><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    xmlns:tools=&quot;http://schemas.android.com/tools&quot;
    android:orientation=&quot;horizontal&quot;
    android:layout_width=&quot;wrap_content&quot;
    android:layout_height=&quot;wrap_content&quot;
    tools:showIn=&quot;@layout/filter_layout&quot;&gt;
    &lt;CheckBox
        android:id=&quot;@+id/cbPlatformFilter&quot;
        android:layout_width=&quot;wrap_content&quot;
        android:layout_height=&quot;wrap_content&quot; /&gt;
    &lt;TextView
        android:layout_marginLeft=&quot;8dp&quot;
        android:layout_marginStart=&quot;8dp&quot;
        android:text=&quot;@string/filter_platform&quot;
        style=&quot;@style/label_style&quot; /&gt;
    &lt;EditText
        android:id=&quot;@+id/etPlatformFilter&quot;
        android:layout_marginLeft=&quot;4dp&quot;
        android:layout_marginStart=&quot;4dp&quot;
        android:minWidth=&quot;60dp&quot;
        android:layout_width=&quot;wrap_content&quot;
        android:layout_height=&quot;wrap_content&quot; /&gt;
&lt;/LinearLayout&gt;</code></pre>

<p>Диалоговое окно фильтра показано на рисунке 2.4</p>
<p><img alt="Диалоговое окно фильтра" src="../img/Storehouse/2.4.png" /></p>
<p>Рисунок 2.4 — диалоговое окно фильтра.</p>
<p>В данном диалоговом окне пользователь может задать условия выборки из БД по определенным критериям, а именно:</p>
<ul>
<li>Цена устройства</li>
<li>Платформа устройства (Android или iOS, а так же номер версии ОС).</li>
<li>Доступные в наличии цвета.</li>
</ul>
<p>При нажатии на кнопку «Продолжить» мы проверяем выбраны ли элементы CheckBox и если да — ставим соответствующий фильтр.</p>
<p>Листинг кода для задания фильтра:  </p>
<pre class="codehilite"><code class="language-Java">public void showFilterDialog(final CallbackFilterDialog callbackFilterDialog) {
    final View v = LayoutInflater.from(context).inflate(R.layout.filter_layout, null);
    final CheckBox cbPriceFilter = ButterKnife.findById(v, R.id.cbPriceFilter);
    final CheckBox cbPlatformFilter = ButterKnife.findById(v, R.id.cbPlatformFilter);
    final CheckBox cbColourFilter = ButterKnife.findById(v, R.id.cbColorFilter);
    final EditText etPlatformFilter = ButterKnife.findById(v, R.id.etPlatformFilter);
    final EditText etColors = ButterKnife.findById(v, R.id.etColors);

    AlertDialog.Builder builder = new AlertDialog.Builder(context)
            .setTitle(R.string.titleChooseFilterProperties)
            .setPositiveButton(R.string.continue_action, new DialogInterface.OnClickListener() {
                @Override
                public void onClick(DialogInterface dialog, int which) {
                    Query query = new Query(MainActivity.COLLECTION_NAME);
                    if (cbPriceFilter.isChecked()) {
                        setPriceFilter(v, query);
                    }

                    if (cbPlatformFilter.isChecked()) {
                        query.equalTo(new DocumentFields(context).getPlatformField(), etPlatformFilter.getText().toString());
                    }

                    if(cbColourFilter.isChecked()) {
                        List&lt;Object&gt; colors = new ArrayList&lt;&gt;();
                        colors.addAll(Arrays.asList(Helper.getStringFrom(etColors).split(&quot;,&quot;)));
                        query.containedIn(new DocumentFields(context).getColorsAvailableField(), colors);
                    }
                    query.findDocuments(new CallbackFindDocument() {
                        @Override
                        public void onDocumentFound(List&lt;DocumentInfo&gt; documentInfos) {
                             callbackFilterDialog.onFilterApplied(documentInfos);
                        }
                        @Override
                        public void onDocumentNotFound(String errorCode, String errorMessage) {
                            Helper.showToast(context, R.string.error);
                        }
                    });
                }
            }).setView(v);
    builder.show();
}

private void setPriceFilter(View view, Query query) {
    String priceField = new DocumentFields(view.getContext()).getDevicePriceField();
    final CheckBox cbIncludeLower = ButterKnife.findById(view, R.id.cbIncludeLower);
    final CheckBox cbIncludeUpper = ButterKnife.findById(view, R.id.cbIncludeUpper);
    final EditText etLowerPrice = ButterKnife.findById(view, R.id.etPriceFrom);
    final EditText etUpperPrice = ButterKnife.findById(view, R.id.etPriceTo);
    if(cbIncludeLower.isChecked()) {
        query.greaterThenOrEqualTo(priceField, getPrice(etLowerPrice));
    } else {
        query.greaterThan(priceField, getPrice(etLowerPrice));
    }
    if(cbIncludeUpper.isChecked()) {
        query.lessThanOrEqualTo(priceField, getPrice(etUpperPrice));
    } else {
        query.lessThan(priceField, getPrice(etUpperPrice));
    }
}</code></pre>

<p>Фильтр задается следующим образом: мы создаем объект <code>Query</code>, выборку мы ведем из нашей коллекции. Далее: если выбран фильтр цены (установлена соответствующая галочка), то мы выбираем из БД только устройства для которых цена попадает в пределы указанных границ.</p>
<p>Границы цен задаются при помощи следующих методов:</p>
<ul>
<li>greaterThan задает нижнюю границу цены (не включая указанную цену).</li>
<li>lessThan задает верхнюю границу цены (не включая указанную цену).</li>
<li>greaterThanOrEqualTo задает нижнюю границу цены включая указанную цену.</li>
<li>lessThanOrEqualTo задает верхнюю границу цены включая указанную цену.</li>
</ul>
<p>Поиск по платформе задается при помощи метода <code>equalTo(field, value)</code> класса <code>Query</code> который указывает экземпляру данного класса оставить в выборке только документы у которых значение поля указанного в параметре <code>field</code> совпадает с <code>value</code>. В нашем случае мы можем например найти все Android 7.0 девайсы, указав <code>query.equalTo(«platform», «Android 7.0»);</code></p>
<p>Поиск по доступным цветам задается при помощи метода <code>containedIn</code> класса <code>Query</code> который оставляет в выборке только те документы для которых поле (типа массив) содержит все элементы заданного массива.</p>
<p>Таким образом мы формируем запрос (query) для указанной коллекции БД и получаем экземпляры класса <code>DocumentInfo</code> характеризующие документы, удовлетворяющие данному запросу. Эту информацию мы передаем в активность при помощи callback и обновляем информацию.</p>
<p>При нажатии на кнопку <img alt="Закончить активную сессию пользователя" src="../img/Storehouse/2.1.3.png" /> происходит завершение активной сессии пользователя (logout) и пользователь попадает обратно на стартовый экран приложения.</p>
<p>Для осуществления данной функциональности нужно задать обработчик нажатия для данной кнопки, вызывающий метод  <code>logout</code> класса <code>User</code> для завершения активной сессии пользователя:</p>
<p><pre class="codehilite"><code class="language-Java">public static void logout(final Context context) {
    LocalPersistence.writeObjectToFile(context, null, LocalPersistence.FILE_USER_INFO);
    new User().logout(new CallbackLogoutUser() {
        @Override
        public void onLogoutSucceed() {
            display(context);
        }

        @Override
        public void onLogoutFailed(String errorCode, String errorMessage) {
            Helper.showToast(context, R.string.error);
        }
    });
}</code></pre>
В данном методе сначала удаляется файл с информацией о пользователе (данный файл хранится локально и используется для проверки того факта, что пользователь прошел идентификацию в приложении) затем используется метод <code>logout(…)</code> класса <code>User</code>, который завершает активную сессию пользователя.</p>
<p>В случае успешного завершения активной сессии пользователя будет вызван метод <code>onLogoutSucceed(...) callback</code> интерфейса, иначе будет вызван метод <code>onLogoutFailed(...)</code>.</p>
<h2 id="_7">Экран подробной информации о устройстве.</h2>
<p>При нажатии на любой из элементов списка устройств главного экрана приложения пользователь попадает на экран подробной информации об устройстве.</p>
<p>Создадим активность с именем <code>ItemDetailsInfo</code> и в layout-файл данной активности добавим следующий xml код:</p>
<pre class="codehilite"><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    xmlns:tools=&quot;http://schemas.android.com/tools&quot;
    android:id=&quot;@+id/activity_detailed_item_info&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;
    android:padding=&quot;16dp&quot;
    android:orientation=&quot;vertical&quot;
    tools:context=&quot;prof_itgroup.ru.storehouseapp.Activities.ItemDetailsActivity&quot;&gt;
    &lt;ScrollView
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;&gt;
            &lt;include layout=&quot;@layout/item_core&quot;/&gt;
    &lt;/ScrollView&gt;
&lt;/LinearLayout&gt;</code></pre>

<p>Как видно layout-файл активности переиспользует xml код экрана добавления элемента в БД, но на данном экране так же присутствует возможность перейти в режим редактирования, т.е актививровать скрытые <code>View</code> экрана.</p>
<p>В <code>ActionBar</code> данного экрана так же добавим иконки для редактирования записи об устройстве (документа), удаления записи об устройстве (документа) и перехода на экран информации об отгрузке.</p>
<p>Для задания иконок в <code>ActionBar</code> создадим layout-файл с именем <code>detailed_info_menu</code> и добавим в него следующий код:</p>
<pre class="codehilite"><code class="language-xml">&lt;menu xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;&gt;
    &lt;item
        android:id=&quot;@+id/action_edit_item&quot;
        android:title=&quot;@string/action_edit_item&quot;
        android:icon=&quot;@drawable/ic_mode_edit_white_24dp&quot;
        app:showAsAction=&quot;always&quot;/&gt;

    &lt;item
        android:id=&quot;@+id/action_remove_item&quot;
        android:title=&quot;@string/action_remove_item&quot;
        android:icon=&quot;@drawable/ic_delete_forever_white_24dp&quot;
        app:showAsAction=&quot;ifRoom&quot;/&gt;

     &lt;item
        android:id=&quot;@+id/action_prepare_item&quot;
        android:icon=&quot;@drawable/ic_assignment_white_24dp&quot;
        android:title=&quot;@string/action_prepare_item&quot;
        app:showAsAction=&quot;ifRoom&quot;/&gt;
&lt;/menu&gt;</code></pre>

<p>В самой активности добавим метод:</p>
<pre class="codehilite"><code class="language-Java">@Override
public boolean onCreateOptionsMenu(Menu menu) {
    getMenuInflater().inflate(R.menu.detailed_info_menu, menu);
    return super.onCreateOptionsMenu(menu);
}</code></pre>

<p>который установит иконки в <code>ActionBar</code>.</p>
<p>Обрабатывать нажатие на иконки мы будем при помощи метода указанного ниже:</p>
<pre class="codehilite"><code class="language-Java">@Override
public boolean onOptionsItemSelected(MenuItem item) {
    switch (item.getItemId()) {
        case android.R.id.home:
            finish();
            break;
        case R.id.action_edit_item:
            setEditMode(true);
            break;
        case R.id.action_remove_item:
            DocumentHelper.fetchAndRemoveDocument(this, document, getDocumentInfo());
            break;
        case R.id.action_prepare_item:
            SendItemActivity.display(this, getDocumentInfo());
            break;
    }
    return super.onOptionsItemSelected(item);
}</code></pre>

<p>В результате получим экран показанный на рисунке 3.1</p>
<p><img alt="экран подробной информации об устройстве" src="../img/Storehouse/3.1.png" /></p>
<p>Рисунок 3.1 — экран подробной информации об устройстве.</p>
<p>В верхней правой части экрана присутствуют следующие иконки:</p>
<p><img alt="Редактировать информацию о устройстве" src="../img/Storehouse/3.1.1.png" /> Редактировать информацию о устройстве</p>
<p><img alt="Удалить данное устройство из БД" src="../img/Storehouse/3.1.2.png" /> Удалить данное устройство из БД</p>
<p><img alt="Перейти к информации об отгрузке данного товара." src="../img/Storehouse/3.1.3.png" /> Перейти к информации об отгрузке данного товара.</p>
<p>При нажатии на кнопку <img alt="Редактировать информацию о устройстве" src="../img/Storehouse/3.1.1.png" /> экран переключается в режим редактирования. Для этого сделаем видимыми кнопки «Добавить цвет», «Удалить цвет», «Увеличить цену на складе», «Уменьшить цену на складе». Экран подробной информации о устройстве в режиме редактирования показан на рисунке 3.2</p>
<p><img alt="Экран подробной информации об устройстве в режиме редактирования" src="../img/Storehouse/3.2.png" /></p>
<p>Рисунок 3.2 — Экран подробной информации об устройстве в режиме редактирования</p>
<p>Зададим обработчик нажатия кнопки «Изменить запись», который будет вызывать следующий метод:</p>
<pre class="codehilite"><code class="language-Java">private void updateItemDocument() {
    document.getDocumentById(getDocumentInfo().getId(), new CallbackGetDocumentById() {
        @Override
        public void onDocumentFound(DocumentInfo documentInfo) {
            document.updateDocument()
                    .set(fields.getDeviceNameField(), getStringFrom(etDeviceName))
                    .set(fields.getPlatformField(), getStringFrom(etDevicePlatform))
                    .set(fields.getCameraInfoField(), getStringFrom(etDeviceCameraInfo));
            setColorsUpdateInfo();
            document.updateDocument().inc(fields.getDevicePriceField(), increaseCount);
            document.saveDocument(new CallbackDocumentSaved() {
                @Override
                public void onDocumentSaved() {
                    setEditMode(false);
                    for (String color : deviceColors.keySet()) {
                        deviceColors.put(color, ColorState.FROM_DB);
                    }
                    document.updateDocument().getUpdateInfo().clear();
                }
                @Override
                public void onDocumentSaveFailed(String errorCode, String errorMessage) {
                    showToast(R.string.error_update_item);
                    setFields();
                }
            });
        }
        @Override
        public void onDocumentNotFound(String errorCode, String errorMessage) {
            showToast(R.string.error_update_item);
            setFields();
        }
    });
}
private void setColorsUpdateInfo() {
    for (String color : deviceColors.keySet()) {
        ColorState colorState = deviceColors.get(color);
        switch (colorState) {
            case TO_REMOVE:
                document.updateDocument().pull(fields.getColorsAvailableField(), color);
                break;

            case NEW:
                document.updateDocument().push(fields.getColorsAvailableField(), color);
                break;
        }
    }
}</code></pre>

<p>Для обновления информации об устройстве используется метод <code>updateDocument()</code> класса <code>Document</code>. При этом экземпляр класса Document обновление которого мы проводим должен быть ассоциирован с реальным документом из БД при помощи метода <code>getDocumentById</code>. При этом новые значения следующих полей:</p>
<ul>
<li>Название устройства (поле deviceName в БД)</li>
<li>ОС устройства (поле platform в БД)</li>
<li>Информация о камере (deviceCameraInfo)</li>
</ul>
<p>задаются при помощи метода <code>set(field, value)</code> класса <code>Update</code>.</p>
<p>Поле «цена устройства» (поле devicePrice в БД) задается при помощи метода <code>.inc(field, value)</code> класса <code>Update</code>. При этом если мы увеличиваем цену, то используем в положительные значения параметра value, если уменьшаем, то отрицательную.</p>
<p>Поле «доступные цвета» (поле colorsAvailable в БД) задается при помощи методов <code>.push()</code> (для добавления цвета устройства) и <code>.pull()</code> (для удаления цвета устройства).</p>
<p>Рассмотрим еще раз работу метода <code>updateItemDocument(...)</code>: для обновления полей документа нам нужно удостовериться, что такой документ существует и ассоциировать наш экземпляр класса <code>Document</code> с документом в БД. Для этого мы используем метод <code>.getDocumentById(…)</code> класса <code>Document</code>.
После того как мы ассоциировали наш документ с документом из БД мы получаем объект класса <code>Update</code> при помощи метода <code>.updateDocument()</code>. Далее используя объект класса Update мы задаем название, платформу и информацию о камере устройства при помощи метода <code>.set(…)</code>, добавляем в массив (при помощи метода <code>.push()</code>) или удаляем из массива (при помощи метода <code>.pull</code>) доступные цвета для данного устройства и изменяем цену (при помощи метода <code>.inc()</code>) в поле цены. После задания всех необходимых изменений в экземпляре класса <code>Update</code> мы производим сохранение документа при помощи метода <code>.saveDocument(…)</code> класса <code>Document</code>.</p>
<p>Поскольку документ получен путем ассоциации с документом из БД (при помощи метода <code>.getDocumentById</code>), то в результате выполнения <code>.saveDocument(…)</code> произойдет обновление документа, а не создание нового документа.</p>
<p>Рассмотрим действие кнопки <img alt="Удалить данное устройство из БД" src="../img/Storehouse/3.1.2.png" /> - при нажатии на данную кнопку происходит удаление информации об устройстве из БД. Для этого добавим обработчик нажатия данной кнопки вызывающий метод показанный ниже:</p>
<pre class="codehilite"><code class="language-Java">public static void fetchAndRemoveDocument(final Context context, final Document document, DocumentInfo documentInfo) {
    document.getDocumentById(documentInfo.getId(), new CallbackGetDocumentById() {
        @Override
        public void onDocumentFound(DocumentInfo documentInfo) {
            removeDocument(context, document);
        }
        @Override
        public void onDocumentNotFound(String errorCode, String errorMessage) {
            Helper.showToast(context, R.string.error_document_not_removed);
        }
    });
}
public static void removeDocument(final Context context, Document document) {
        document.removeDocument(new CallbackRemoveDocument() {
            @Override
            public void onRemoveSucceed(ResponseRemove responseRemove) {
                Toast.makeText(context, context.getString(R.string.document_removed), Toast.LENGTH_SHORT).show();
                ((Activity) context).finish();
            }
            @Override
            public void onRemoveFailed(String errorCode, String errorMessage) {
                Toast.makeText(context, context.getString(R.string.error_document_not_removed), Toast.LENGTH_SHORT).show();
            }
        });
}</code></pre>

<p>Рассмотрим данный метод подробней:
Сначала мы используем метод <code>.getDocumentById(...)</code> класса <code>Document</code> для того чтобы удостовериться, что такой документ существует и провести ассоциацию данного документа с созданным нами экземпляром класса <code>Document</code>.</p>
<p>После того как мы удостоверились в наличии данного документа мы вызываем метод <code>.removeDocument()</code> класса <code>Document</code> который удаляет документ из БД.</p>
<p>Рассмотрим действие кнопки <img alt="Перейти к информации об отгрузке данного товара." src="../img/Storehouse/3.1.3.png" />. При нажатии на эту кнопку мы переходим к экрану с информацией об отгрузке товара. </p>
<h2 id="_8">Экран информации об отгрузке товара.</h2>
<p>Создадим новую активность с именем <code>SendItemActivity</code> и добавим в layout-файл данной активности следующий xml код:</p>
<pre class="codehilite"><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    xmlns:tools=&quot;http://schemas.android.com/tools&quot;
    android:id=&quot;@+id/activity_send_item&quot;
    android:layout_width=&quot;match_parent&quot;
    android:layout_height=&quot;match_parent&quot;
    android:padding=&quot;16dp&quot;
    android:orientation=&quot;vertical&quot;
    tools:context=&quot;prof_itgroup.ru.storehouseapp.Activities.SendItemActivity&quot;&gt;
    &lt;LinearLayout
        android:id=&quot;@+id/llWaitingUsers&quot;
        android:orientation=&quot;vertical&quot;
        android:layout_width=&quot;match_parent&quot;
        android:layout_height=&quot;wrap_content&quot;&gt;
        &lt;TextView
            style=&quot;@style/label_style&quot;
            android:textColor=&quot;@android:color/black&quot;
            android:text=&quot;@string/action_waiting_list&quot;/&gt;
        &lt;TextView
            android:id=&quot;@+id/tvWaitingUsers&quot;
            style=&quot;@style/label_style&quot;/&gt;
        &lt;TextView
            android:id=&quot;@+id/tvLastChangeLabel&quot;
            android:textColor=&quot;@android:color/black&quot;
            android:layout_marginTop=&quot;8dp&quot;
            style=&quot;@style/label_style&quot;
            android:text=&quot;@string/last_change&quot;/&gt;
        &lt;TextView
            android:id=&quot;@+id/tvLastChange&quot;
            style=&quot;@style/label_style&quot;/&gt;
        &lt;LinearLayout
            android:id=&quot;@+id/llInfoContainer&quot;
            android:orientation=&quot;vertical&quot;
            android:layout_width=&quot;match_parent&quot;
            android:layout_height=&quot;wrap_content&quot;&gt;
            &lt;RelativeLayout
                android:layout_width=&quot;match_parent&quot;
                android:layout_height=&quot;wrap_content&quot;&gt;
                &lt;TextView
                    android:layout_marginTop=&quot;8dp&quot;
                    android:textColor=&quot;@android:color/black&quot;
                    android:text=&quot;@string/item_info&quot;
                    style=&quot;@style/label_style&quot; /&gt;
                &lt;TextView
                    android:id=&quot;@+id/tvEdit&quot;
                    android:layout_alignParentRight=&quot;true&quot;
                    android:layout_marginTop=&quot;10dp&quot;
                    android:text=&quot;@string/editInfo&quot;
                    android:textColor=&quot;@color/colorPrimary&quot;
                    android:layout_width=&quot;wrap_content&quot;
                    android:layout_height=&quot;wrap_content&quot; /&gt;
            &lt;/RelativeLayout&gt;
            &lt;ScrollView
                android:layout_marginTop=&quot;8dp&quot;
                android:layout_width=&quot;wrap_content&quot;
                android:layout_height=&quot;180dp&quot;&gt;
                &lt;EditText
                    android:id=&quot;@+id/etItemInfo&quot;
                    android:enabled=&quot;false&quot;
                    android:layout_width=&quot;wrap_content&quot;
                    android:layout_height=&quot;180dp&quot; /&gt;
            &lt;/ScrollView&gt;
        &lt;/LinearLayout&gt;
    &lt;/LinearLayout&gt;
    &lt;LinearLayout
        android:orientation=&quot;vertical&quot;
        android:layout_gravity=&quot;center_horizontal&quot;
        android:layout_width=&quot;wrap_content&quot;
        android:layout_height=&quot;wrap_content&quot;&gt;
        &lt;Button
            android:layout_marginTop=&quot;8dp&quot;
            android:layout_gravity=&quot;center_horizontal&quot;
            android:id=&quot;@+id/btnAppUserInList&quot;
            android:text=&quot;@string/addUserInList&quot;
            android:layout_width=&quot;match_parent&quot;
            android:layout_height=&quot;wrap_content&quot; /&gt;
        &lt;Button
            android:layout_marginTop=&quot;8dp&quot;
            android:layout_gravity=&quot;center_horizontal&quot;
            android:id=&quot;@+id/btnSendToUser&quot;
            android:text=&quot;@string/sendToUser&quot;
            android:layout_width=&quot;match_parent&quot;
            android:layout_height=&quot;wrap_content&quot; /&gt;
    &lt;/LinearLayout&gt;
&lt;/LinearLayout&gt;</code></pre>

<p>Полученный экран показан на рисунке  4.1</p>
<p><img alt="экран с информацией об отгрузке товара" src="../img/Storehouse/4.1.png" /></p>
<p>Рисунок 4.1 — экран с информацией об отгрузке товара</p>
<p>При нажатии на кнопку «ДОБАВИТЬ ПОКУПАТЕЛЯ» вызывается диалоговое окно с просьбой ввести информацию о покупателе после чего вызывается метод:</p>
<pre class="codehilite"><code class="language-Java">private void addBuyerAndRefreshWaitingList(final String buyerInfo) {
    if(!buyerInfo.trim().isEmpty()) {
        document.getDocumentById(getDocumentInfo().getId(), new CallbackGetDocumentById() {
            @Override
            public void onDocumentFound(DocumentInfo documentInfo) {
                document.updateDocument().push(fields.getBuyersField(), buyerInfo);
                document.saveDocument(new CallbackDocumentSaved() {
                    @Override
                    public void onDocumentSaved() {
                        document.updateDocument().getUpdateInfo().clear();
                        refreshWaitingList();
                        showToast(getBaseContext(), R.string.add_waiting_buyer);
                    }
                    @Override
                    public void onDocumentSaveFailed(String errorCode, String errorMessage) {
                        showToast(getBaseContext(), R.string.error);
                    }
                });
            }
            @Override
            public void onDocumentNotFound(String errorCode, String errorMessage) {
                showToast(getBaseContext(), R.string.error);
            }
        });
    }
}</code></pre>

<p>Рассмотрим метод более подробно. Сначала проверяем, что введенное поле с именем клиента не является пустым. В случае если пользователь ввел данные происходит ассоциация экземпляра класса Document с документом в БД после чего происходит обновление информации документа следующем образом: веденная пользователем информация о покупателе добавляется в конец массива покупателей с помощью метода <code>.push()</code> класса <code>Update</code>. Таким образом формируется очередь покупателей, ожидающих отправки товара.</p>
<p>При нажатии на кнопку «ОТГРУЗИТЬ ПОЛЬЗОВАТЕЛЮ» из массива ожидающих отправки клиентов должен удаляться первый клиент, должно сохраняться время последней отправки и сотрудники (грузчики, курьеры, бухгалтерия) должны быть оповещены об этом.<br />
Для этого добавим обработчик для данной кнопки, который вызывает метод показанный ниже:</p>
<pre class="codehilite"><code class="language-Java">@OnClick(R.id.btnSendToUser)
public void onSendToUserButtonClicked() {
    document.getDocumentById(getDocumentInfo().getId(), new CallbackGetDocumentById() {
        @Override
        public void onDocumentFound(final DocumentInfo documentInfo) {
            document.updateDocument()
                    .popFirst(fields.getBuyersField())
                    .setCurrentDate(fields.getLastSendField());

         document.saveDocument(new CallbackDocumentSaved() {
                @Override
                public void onDocumentSaved() {
                    document.updateDocument().getUpdateInfo().clear();
                    new ItemNotificator(getBaseContext(), documentInfo.getId(), fields.getDeviceName()).notifyPersonalAboutItemSend();
                    new BalanceNotificator(getBaseContext()).refreshCompanyBalance();
                    etItemInfo.setVisibility(View.VISIBLE);
                    etItemInfo.append(fields.getLastSendTime());
                    refreshWaitingList();
                }

               @Override
                public void onDocumentSaveFailed(String errorCode, String errorMessage) {
                    showToast(getBaseContext(), R.string.error);
                }
            });
 }</code></pre>

<p>В данном методе происходит ассоциация экземпляра класса <code>Document</code> с документом из БД при помощи метода <code>.getDocumentById()</code> класса <code>Document</code>, после чего получается экземпляр класса <code>Update</code> и используется его метод <code>.popFirst</code> который удаляет первый элемент массива (имитируя обслуживание первого человека в очереди). Кроме того в поле «Последняя отгрузка совершена в» (поле lastSend в БД) записывается время последней отгрузки при помощи метода <code>.setCurrentDate(…)</code> класса <code>Update</code>.</p>
<p>Так же на этом экране присутствует комментарий к отгрузке товара, который хранится в файле документа (поле sendInfo типа File). По умолчанию этот файл отсутствует и в текстовое окно выдается информацию по умолчанию «По товару в настоящее время нет комментария ...». Пользователь может нажать кнопку «редактировать», изменить комментарий к отгрузке и нажать «сохранить». При этом будет вызван метод:</p>
<pre class="codehilite"><code class="language-Java">public static void uploadFile(final Context context, Document document, String content) {
    document.uploadFile(new DocumentFields(context).getSendInfoField(), FILE_NAME, encode(content.getBytes()),
        new CallbackUploadFile() {
        @Override
        public void onDocumentUploaded() {
        //file loaded
        }

        @Override
        public void onDocumentUploadFailed(String errorCode, String errorMessage) {
            Helper.showToast(context, R.string.error);
        }
    });
}</code></pre>

<p>Данный метод загружает файл в поле (типа File) документа БД. Документ при этом должен быть ассоциирован при помощи метода <code>getDocumentById(…)</code>. Аналогичным образом происходит удаление документа из БД.</p>
<p>Информация о пользователях, ожидающих отгрузки и комментарии загружаются с сервера при помощи метода показанного ниже.</p>
<pre class="codehilite"><code class="language-Java">private void refreshWaitingList() {
    document.getDocumentById(getDocumentInfo().getId(), new CallbackGetDocumentById() {
        @Override
        public void onDocumentFound(DocumentInfo documentInfo) {
            fields.setDocumentInfo(documentInfo);
            tvWaitingUsers.setText(fields.getBuyers());
            tvLastChange.setText(fields.getLastSendTime());
            llWaitingUsers.setVisibility(fields.getBuyers().isEmpty() ? View.GONE : View.VISIBLE);
            tvLastChangeLabel.setVisibility(fields.getLastSendTime().isEmpty() ? View.GONE : View.VISIBLE);
            tvLastChange.setVisibility(fields.getLastSendTime().isEmpty() ? View.GONE : View.VISIBLE);
            btnSendToUser.setVisibility(fields.getBuyers().isEmpty() ? View.GONE : View.VISIBLE);
            document.getFileContent(fields.getSendInfoField(), FileHelper.FILE_NAME, new CallbackGetFile() {
                @Override
                public void onSucceed(String fileContent) {
                    if(fileContent != null &amp;&amp; !fileContent.trim().isEmpty()) {
                        etItemInfo.setText(fileContent);
                    } else {
                        etItemInfo.setText(R.string.no_info);
                    }
                }
                @Override
                public void onFailed(String errorCode, String errorMessage) {
                    showToast(getBaseContext(), R.string.error);
                }
            });
        }
        @Override
        public void onDocumentNotFound(String errorCode, String errorMessage) {
            tvWaitingUsers.setVisibility(View.GONE);
        }
    });
}</code></pre>

<p>В данном методе происходит ассоциация экземпляра класса <code>Document</code> с документом из БД после чего на экране обновляются значения следующих полей:
1. список ожидающих пользователей
2. время последней отгрузки
3. устанавливается видимость тех или иных элементов в зависимости от контента.
4. При помощи метода getFileContent класса Document получаем содержимое файла в виде строки (с сохранением форматирования). Полученную строку устанавливаем в поле комментария.</p>
<p>Так же создадим класс  ItemNotificator и добавим в него метод notifyPersonalAboutItemSend()
который будем вызывать при отгрузке товара пользователю. Код метода показан ниже
public void notifyPersonalAboutItemSend() {
    sendPushToLoaderPerson();
    sendEmailInAccountingDepartment();
    sendSmsToDeliveryPerson();
}</p>
<p>Данный метод проводит уведомление персонала о том, что товар подготовлен к отправке следующим образом:</p>
<ul>
<li>отсылает push сообщение грузчику при помощи метода:</li>
</ul>
<pre class="codehilite"><code class="language-Java">private void sendPushToLoaderPerson() {
    Query query = new Query(&quot;roles&quot;);
    query.equalTo(&quot;name&quot;, &quot;loaderPerson&quot;);
    query.equalTo(&quot;isFree&quot;, true);
    query.setLimit(1);

    MessagePush messagePush = new MessagePush(context.getString(R.string.you_should_take) + getItemInfo() + context.getString(R.string.and_prepare), null);
    message.sendPush(messagePush, query, new CallbackSendPush() {
        @Override
        public void onPushSended() {
            Helper.showToast(context, R.string.push_sended);
        }
        @Override
        public void onPushSendFailed(String errorCode, String errorMessage) {
            Helper.showToast(context, R.string.cant_send_push);
        }
    });
}</code></pre>

<ul>
<li>отсылает sms сообщение курьеру</li>
</ul>
<pre class="codehilite"><code class="language-Java">private void sendSmsToDeliveryPerson() {
    Query query = new Query(&quot;roles&quot;);
    query.equalTo(&quot;name&quot;, &quot;deliveryPerson&quot;);
    query.equalTo(&quot;isFree&quot;, true);
    query.setLimit(1);

    MessageSms messageSms = new MessageSms(context.getString(R.string.take_item) + getItemInfo());
    message.sendSms(messageSms, query, new CallbackSendSms() {
        @Override
        public void onSmsSended() {
            Helper.showToast(context, R.string.sms_was_sended);
        }

        @Override
        public void onSmsSendFailed(String errorCode, String errorMessage) {
            Helper.showToast(context, R.string.cant_send_sms);
        }
    });
}</code></pre>

<ul>
<li>отсылает email в бухгалтерию.</li>
</ul>
<pre class="codehilite"><code class="language-Java">private void sendEmailInAccountingDepartment() {
    Query query = new Query(&quot;roles&quot;);
    query.equalTo(&quot;name&quot;, &quot;accountantPerson&quot;);

    MessageEmail messageEmail = new MessageEmail(context.getString(R.string.from), context.getString(R.string.device) + getItemInfo() , context.getString(R.string.device) + getItemInfo() + context.getString(R.string.sold));
    message.sendEmail(messageEmail, query, new CallbackSendEmail() {
        @Override
        public void onEmailSend() {
            Helper.showToast(context, R.string.email_was_sended);
        }
        @Override
        public void onEmailSendFailed(String errorCode, String errorMessage) {
            Helper.showToast(context, R.string.cant_send_email);
        }
    });
}</code></pre>

<p>Рассмотрим работу этих методов более подробно:</p>
<ol>
<li>В методе <code>sendEmailInAccountingDepartment</code> из коллекции ролей («roles») выбирается роль «accountantPerson» и всем пользователям с такой ролью отсылаются email сообщения при помощи метода <code>.sendEmail()</code> класса <code>Message</code>.</li>
<li>В методе <code>sendSmdToDeliveryPerson</code> из коллекции ролей («roles») выбирается один (условие setLimit(1)) свободный (условие isFree == true) сотрудник с ролью «deliveryPerson» и ему отправляется sms при помощи метода <code>.sendSms</code> класса <code>Message</code>.</li>
<li>В методе <code>sendSmdToLoaderPerson</code> из коллекции ролей («roles») выбирается один (условие setLimit(1)) свободный (условие isFree == true) сотрудник с ролью loaderPerson и ему отправляется push при помощи метода <code>.sendPush</code> класса <code>Message</code>.</li>
</ol>
<p>Кроме того после нажатия на кнопку «ОТГРУЗИТЬ ПОЛЬЗОВАТЕЛЮ» вызывается метод <code>refreshCompanyBalance()</code> класса <code>BalanceNotivicator</code>.</p>
<p>Листинг метода <code>resreshCompanyBalance()</code>:</p>
<pre class="codehilite"><code class="language-Java">public void refreshCompanyBalance() {
    Script script = new Script();
    script.runScript(&quot; 5800ad9342d52f1ba275fbcd&quot;, new CallbackSendScript() {
        @Override
        public void onScriptSended() {
            Helper.showToast(context, R.id.balance_refreshed);
        }
        @Override
        public void onScriptSendFailed(String errorCode, String errorMessage) {
            Helper.showToast(context, R.id.can_refresh_balance);
        }
    });
}</code></pre>

<p>В данном листинге при помощи метода <code>runScript(...)</code> класса <code>Script</code> вызывается серверный код с id 5800ad9342d52f1ba275fbcd, который пересчитывает количество товаров на складе, издержки на хранение и другие характеристики.</p>
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../ScorocodeScript/" title="Класс ScorocodeScript" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Класс ScorocodeScript
              </span>
            </div>
          </a>
        
        
          <a href="../../SWIFT/ToDoList/" title="Список задач (iOs)" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Список задач (iOs)
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://github.com/scorocode" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://www.facebook.com/scorocode" class="md-footer-social__link fa fa-facebook"></a>
    
      <a href="https://www.linkedin.com/company/prof-it-group" class="md-footer-social__link fa fa-linkedin"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application-2afe21e0b2.js"></script>
      <script>var config={url:{base:"../.."}},app=new Application(config);app.initialize()</script>
      
    
    
      
    
  </body>
</html>